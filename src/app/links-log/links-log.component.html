<mat-tab-group>
    <!-- TAB 1: Summary (by employee & quarter) -->
    <mat-tab label="סיכום משתמש/רבעון">
      <form class="page" dir="rtl" [formGroup]="filterForm">
        <mat-toolbar color="primary" class="toolbar">
          <span>{{ Title1 }}</span>
          <span class="spacer"></span>
  
          <mat-form-field class="from-field" appearance="outline">
            <mat-label>מתאריך</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="fromDate">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
  
          <button mat-raised-button color="accent" (click)="loadSummary()" [disabled]="loadingSummary">רענן</button>
          <button mat-button (click)="exportSummaryToExcel()" [disabled]="loadingSummary || !matTableDataSource.data.length">
            ייצוא Excel
          </button>
        </mat-toolbar>
  
        <mat-progress-bar *ngIf="loadingSummary" mode="indeterminate"></mat-progress-bar>
  
        <div class="summary">
          <span>{{ Title2 }} {{ totalResults | number }} {{ titleUnit }}</span>
        </div>
  
        <div class="filters">
          <mat-form-field appearance="outline" class="filter">
            <mat-label>סינון כללי</mat-label>
            <input matInput placeholder="הקלד לחיפוש..." formControlName="globalFilter">
            <button mat-icon-button matSuffix *ngIf="filterForm.get('globalFilter')?.value" (click)="clearGlobal()">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
  
          <mat-form-field appearance="outline" class="filter">
            <mat-label>תיאור קישור</mat-label>
            <input matInput formControlName="linkDescription">
          </mat-form-field>
  
          <mat-form-field appearance="outline" class="filter">
            <mat-label>LinkId</mat-label>
            <input matInput formControlName="linkId">
          </mat-form-field>
  
          <mat-form-field appearance="outline" class="filter">
            <mat-label>עובד</mat-label>
            <input matInput formControlName="employee_Name">
          </mat-form-field>
        </div>
      </form>
  
      <div class="table-wrap">
        <table mat-table [dataSource]="matTableDataSource" matSort #sortSummary="matSort" matSortDisableClear>
  
          <ng-container matColumnDef="linkDescription">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> תיאור קישור </th>
            <td mat-cell *matCellDef="let r">{{ r.linkDescription }}</td>
          </ng-container>
  
          <ng-container matColumnDef="linkId">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> LinkId </th>
            <td mat-cell *matCellDef="let r"><code>{{ r.linkId }}</code></td>
          </ng-container>
  
          <ng-container matColumnDef="employee_Name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> עובד </th>
            <td mat-cell *matCellDef="let r">{{ r.employee_Name }}</td>
          </ng-container>
  
          <ng-container matColumnDef="period">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> תקופה </th>
            <td mat-cell *matCellDef="let r">Q{{ r.tq }} {{ r.ty }}</td>
          </ng-container>
  
          <ng-container matColumnDef="userCountPerLink">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> ספירה </th>
            <td mat-cell *matCellDef="let r">{{ r.userCountPerLink | number }}</td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: columns;"></tr>
  
          <tr class="no-data" *matNoDataRow>
            <td colspan="5">אין נתונים להצגה</td>
          </tr>
        </table>
      </div>
  
      <mat-paginator #paginatorSummary [pageSizeOptions]="[10,25,50,100]" [pageSize]="25" showFirstLastButtons></mat-paginator>
    </mat-tab>
  
    <!-- TAB 2: Period totals -->
    <mat-tab label="סיכומי תקופות">
      <div class="page" dir="rtl">
        <mat-toolbar color="primary" class="toolbar">
          <span>סיכומי תקופות לפי קישור</span>
          <span class="spacer"></span>
  
          <mat-form-field appearance="outline" class="filter">
            <mat-label>סינון</mat-label>
            <input matInput placeholder="חפש..." [formControl]="totalsFilterCtrl">
            <button mat-icon-button matSuffix *ngIf="totalsFilterCtrl.value" (click)="totalsFilterCtrl.setValue('')">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
  
          <button mat-raised-button color="accent" (click)="loadTotals()" [disabled]="loadingTotals">רענן</button>
          <button mat-button (click)="exportTotalsToExcel()" [disabled]="loadingTotals || !matTableDataSourceTotals.data.length">
            ייצוא Excel
          </button>
        </mat-toolbar>
  
        <mat-progress-bar *ngIf="loadingTotals" mode="indeterminate"></mat-progress-bar>
  
        <div class="summary">
          <span>{{ totalResultsTotals | number }} רשומות</span>
        </div>
  
        <div class="table-wrap">
          <table mat-table [dataSource]="matTableDataSourceTotals" matSort #sortTotals="matSort" matSortDisableClear>
  
            <ng-container matColumnDef="linkDescription">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> תיאור קישור </th>
              <td mat-cell *matCellDef="let r">{{ r.linkDescription }}</td>
            </ng-container>
  
            <ng-container matColumnDef="today">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> היום </th>
              <td mat-cell *matCellDef="let r">{{ r.today }}</td>
            </ng-container>
  
            <ng-container matColumnDef="thisMonth">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> החודש </th>
              <td mat-cell *matCellDef="let r">{{ r.thisMonth }}</td>
            </ng-container>
  
            <ng-container matColumnDef="thisQuarter">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> רבעון </th>
              <td mat-cell *matCellDef="let r">{{ r.thisQuarter }}</td>
            </ng-container>
  
            <ng-container matColumnDef="thisYear">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> השנה </th>
              <td mat-cell *matCellDef="let r">{{ r.thisYear }}</td>
            </ng-container>
  
            <ng-container matColumnDef="allTime">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> כל הזמנים </th>
              <td mat-cell *matCellDef="let r">{{ r.allTime }}</td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="totalsColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: totalsColumns;"></tr>
  
            <tr class="no-data" *matNoDataRow>
              <td colspan="6">אין נתונים להצגה</td>
            </tr>
          </table>
        </div>
  
        <mat-paginator #paginatorTotals [pageSizeOptions]="[10,25,50,100]" [pageSize]="25" showFirstLastButtons></mat-paginator>
      </div>
    </mat-tab>
  </mat-tab-group>
  