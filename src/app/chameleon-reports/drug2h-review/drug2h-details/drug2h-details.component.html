<h2 mat-dialog-title class="table-title">
  פרטי תרופות עבור יחידה:
  {{
    (data?.unit_Name || data?.Unit_Name)?.length
      ? ((data.unit_Name || data.Unit_Name)[0].toLowerCase() + (data.unit_Name || data.Unit_Name).slice(1))
      : (data?.unit_Name || data?.Unit_Name)
  }}
</h2>

<!-- Spinner -->
<div *ngIf="loading" class="loading-container">
  <mat-spinner></mat-spinner>
  <p>מייבא נתונים...</p>
</div>

<mat-dialog-content>
  <mat-table [dataSource]="dataSource" class="mat-elevation-z8" dir="rtl">
    <!-- Unit Name -->
    <ng-container matColumnDef="unit_Name">
      <mat-header-cell *matHeaderCellDef> שם יחידה </mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{
          (element?.unit_Name || element?.Unit_Name)?.length
            ? ((element.unit_Name || element.Unit_Name)[0].toLowerCase() + (element.unit_Name || element.Unit_Name).slice(1))
            : (element?.unit_Name || element?.Unit_Name)
        }}
      </mat-cell>
    </ng-container>

    <!-- Order ID -->
    <ng-container matColumnDef="order_ID">
      <mat-header-cell *matHeaderCellDef> מזהה הזמנה </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.order_ID }} </mat-cell>
    </ng-container>

    <!-- Drug (only if you decide to display it; add 'drug' to displayedColumns if used) -->
    <ng-container matColumnDef="drug">
      <mat-header-cell *matHeaderCellDef> תרופה </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.drug }} </mat-cell>
    </ng-container>

    <!-- Drugs Text -->
    <ng-container matColumnDef="drugs_Text">
      <mat-header-cell *matHeaderCellDef> טקסט תרופה </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.drugs_Text }} </mat-cell>
    </ng-container>

    <!-- Basic Name -->
    <ng-container matColumnDef="basic_Name">
      <mat-header-cell *matHeaderCellDef> שם בסיסי </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.basic_Name }} </mat-cell>
    </ng-container>

    <!-- Remarks -->
    <ng-container matColumnDef="remarks">
      <mat-header-cell *matHeaderCellDef> הערות </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.remarks }} </mat-cell>
    </ng-container>

    <!-- Execution Status -->
    <ng-container matColumnDef="exec_Status">
      <mat-header-cell *matHeaderCellDef> סטטוס ביצוע </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.exec_Status }} </mat-cell>
    </ng-container>

    <!-- Execution Status Name -->
    <ng-container matColumnDef="exec_Status_Name">
      <mat-header-cell *matHeaderCellDef> שם סטטוס ביצוע </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.exec_Status_Name }} </mat-cell>
    </ng-container>

    <!-- IV State -->
    <ng-container matColumnDef="iV_State">
      <mat-header-cell *matHeaderCellDef> מצב IV </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.iV_State }} </mat-cell>
    </ng-container>

    <!-- IV State Description -->
    <ng-container matColumnDef="iV_State_Desc">
      <mat-header-cell *matHeaderCellDef> תיאור מצב IV </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.iV_State_Desc }} </mat-cell>
    </ng-container>

    <!-- Way Of Giving -->
    <ng-container matColumnDef="way_Of_Giving">
      <mat-header-cell *matHeaderCellDef> דרך מתן </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.way_Of_Giving }} </mat-cell>
    </ng-container>

    <!-- Order Stop Date -->
    <ng-container matColumnDef="order_Stop_Date">
      <mat-header-cell *matHeaderCellDef> תאריך הפסקת הזמנה </mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.order_Stop_Date | date: 'dd/MM/yyyy HH:mm' }}
      </mat-cell>
    </ng-container>

    <!-- Patient -->
    <ng-container matColumnDef="patient">
      <mat-header-cell *matHeaderCellDef> מזהה מטופל </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.patient }} </mat-cell>
    </ng-container>

    <!-- First Name -->
    <ng-container matColumnDef="first_Name">
      <mat-header-cell *matHeaderCellDef> שם פרטי </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.first_Name }} </mat-cell>
    </ng-container>

    <!-- Last Name -->
    <ng-container matColumnDef="last_Name">
      <mat-header-cell *matHeaderCellDef> שם משפחה </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.last_Name }} </mat-cell>
    </ng-container>

    <!-- ID Number -->
    <ng-container matColumnDef="id_Num">
      <mat-header-cell *matHeaderCellDef> תעודת זהות </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.id_Num }} </mat-cell>
    </ng-container>

    <!-- Execution Date -->
    <ng-container matColumnDef="execution_Date">
      <mat-header-cell *matHeaderCellDef> תאריך ביצוע </mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.execution_Date | date: 'dd/MM/yyyy HH:mm' }}
      </mat-cell>
    </ng-container>

    <!-- Next Execution Date (include 'next_Execution_Date' in displayedColumns if you keep this) -->
    <ng-container matColumnDef="next_Execution_Date">
      <mat-header-cell *matHeaderCellDef> תאריך ביצוע הבא </mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{ element.next_Execution_Date | date: 'dd/MM/yyyy' }}
      </mat-cell>
    </ng-container>

    <!-- Time Difference HH:MM -->
    <ng-container matColumnDef="time_Difference_HHMM">
      <mat-header-cell *matHeaderCellDef> זמן בין ביצועים (שעות:דקות) </mat-header-cell>
      <mat-cell
        *matCellDef="let element"
        [ngStyle]="{
          'background-color': isTimeDifferenceAboveTwoHours(element.time_Difference_HHMM) ? '#ffcccc' : 'transparent'
        }"
      >
        {{ element.time_Difference_HHMM }}
      </mat-cell>
    </ng-container>

    <!-- Rows -->
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
  </mat-table>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <img
    src="../../assets/excel.png"
    alt="Download"
    (click)="exportToExcel()"
    class="download-icon icon"
    width="50px"
    style="margin-left: 10px; cursor: pointer;"
  />
  <button mat-raised-button color="primary" mat-dialog-close>סגור</button>
</mat-dialog-actions>
