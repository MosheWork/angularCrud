<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

<div class="body">
  <!-- Page Title with Dynamic Results Count -->
 

  <!-- Filter Card -->
  <div class="filter-card">
    <form [formGroup]="searchForm" dir="rtl" class="filter-form">
      <div class="container-fluid mb-2">
        <div class="row search-count">
          <div class="col">
            <div dir="rtl" class="card">
              <div dir="rtl" class="card-body">
                <div class="filter-container">
                  <!-- admissionNo -->
                  <mat-form-field class="filter-field">
                    <mat-label>מספר מקרה</mat-label>
                    <input matInput formControlName="admissionNo" placeholder="הזן מספר מקרה" />
                  </mat-form-field>

                  <!-- idNo -->
                  <mat-form-field class="filter-field">
                    <mat-label>מספר תעודת זהות</mat-label>
                    <input matInput formControlName="idNo" placeholder="הזן מספר תעודת זהות" />
                  </mat-form-field>

                  <!-- userCode autocomplete -->
                  <mat-form-field class="filter-field">
                    <mat-label>חיפוש עובד </mat-label>
                    <input type="text" matInput [formControl]="userCodeControl" [matAutocomplete]="autoUser" />
                    <mat-autocomplete #autoUser="matAutocomplete" [displayWith]="displayUser">
                      <mat-option *ngFor="let option of filteredUserOptions" [value]="option">
                        {{ option.displayName }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>

                  <!-- startDate -->
                  <mat-form-field class="filter-field">
                    <mat-label>תאריך התחלה</mat-label>
                    <input matInput [matDatepicker]="startDatePicker" formControlName="startDate" placeholder="בחר תאריך התחלה" />
                    <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                    <mat-datepicker #startDatePicker></mat-datepicker>
                  </mat-form-field>

                  <!-- endDate -->
                  <mat-form-field class="filter-field">
                    <mat-label>תאריך סיום</mat-label>
                    <input matInput [matDatepicker]="endDatePicker" formControlName="endDate" placeholder="בחר תאריך סיום" />
                    <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                    <mat-datepicker #endDatePicker></mat-datepicker>
                  </mat-form-field>

                  <!-- Fetch -->
                  <button mat-button (click)="fetchData()" mat-raised-button color="primary" class="custom-button" style="margin-right: 10px;">
                    <i class="material-icons">search</i>
                  </button>

                  <!-- globalFilter -->
                  <mat-form-field class="long-search-bar" style="flex-grow: 1; margin-right: 10px;">
                    <mat-label class="filters" style="color: blue">חיפוש</mat-label>
                    <input matInput formControlName="globalFilter" class="search-input" />
                  </mat-form-field>

                  <!-- Icons -->
                  <img src="../../assets/excel.png" alt="Download" (click)="exportToExcel()" class="download-icon icon" width="50px" style="margin-left: 10px;" />

                  <button
                    mat-button
                    (click)="resetFilters()"
                    mat-raised-button
                    color="primary"
                    class="custom-button"
                    matTooltip="איפוס סינונים"
                    style="margin-left: 10px;">
                    <i class="material-icons">refresh</i>
                  </button>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- End container-fluid -->
    </form>
  </div> <!-- End filter-card -->

  <!-- Data Table -->
  <!-- Data Table -->
  <table mat-table [dataSource]="matTableDataSource" matSort dir="rtl" class="mat-elevation-z8">

    <!-- admissionNo -->
    <ng-container matColumnDef="admissionNo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>מספר מקרה</th>
      <td mat-cell *matCellDef="let element">{{ element.admissionNo }}</td>
    </ng-container>

    <!-- answerText10 -->
    <ng-container matColumnDef="answerText10">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>חוצץ</th>
      <td mat-cell *matCellDef="let element">{{ element.answerText10 }}</td>
    </ng-container>

    <!-- answerText398 -->
    <ng-container matColumnDef="answerText398">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>סקטור</th>
      <td mat-cell *matCellDef="let element">{{ element.answerText398 }}</td>
    </ng-container>

    <!-- firstName -->
    <ng-container matColumnDef="firstName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>(עובד)שם פרטי</th>
      <td mat-cell *matCellDef="let element">{{ element.firstName }}</td>
    </ng-container>

    <!-- lastName -->
    <ng-container matColumnDef="lastName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>(עובד)שם משפחה</th>
      <td mat-cell *matCellDef="let element">{{ element.lastName }}</td>
    </ng-container>

    <!-- idNo -->
    <ng-container matColumnDef="idNo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>מספר זהות</th>
      <td mat-cell *matCellDef="let element">{{ element.idNo }}</td>
    </ng-container>

    <!-- medicalLicense -->
    <ng-container matColumnDef="medicalLicense">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>רישיון רפואי</th>
      <td mat-cell *matCellDef="let element">{{ element.medicalLicense || '' }}</td>
    </ng-container>

    <!-- recordName -->
    <ng-container matColumnDef="recordName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>שם רשומה</th>
      <td mat-cell *matCellDef="let element">{{ element.recordName }}</td>
    </ng-container>

    <!-- recordOpenDate -->
    <ng-container matColumnDef="recordOpenDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>תאריך כניסה לרשומה</th>
      <td mat-cell *matCellDef="let element">{{ element.recordOpenDate | date:'dd/MM/yyyy' }}</td>
    </ng-container>

    <!-- recordOpenTime -->
    <ng-container matColumnDef="recordOpenTime">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>זמן כניסה לרשומה</th>
      <td mat-cell *matCellDef="let element">{{ element.recordOpenTime | date:'HH:mm' }}</td>
    </ng-container>

    <!-- unitName -->
    <ng-container matColumnDef="unitName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>שם יחידה</th>
      <td mat-cell *matCellDef="let element">{{ element.unitName }}</td>
    </ng-container>

    <!-- header & rows -->
    <tr mat-header-row *matHeaderRowDef="columns"></tr>
    <tr mat-row *matRowDef="let row; columns: columns;"></tr>
  </table>
  <!-- Paginator -->
  <mat-paginator
    [length]="matTableDataSource.paginator?.length || 0"
    [pageIndex]="matTableDataSource.paginator?.pageIndex"
    [pageSize]="matTableDataSource.paginator?.pageSize"
    [pageSizeOptions]="[15, 50, 100]">
  </mat-paginator>
</div>
