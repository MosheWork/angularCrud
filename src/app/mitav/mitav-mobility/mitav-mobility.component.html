<!-- Loader (Full Page) -->
<div *ngIf="isLoading" class="loading-screen">
  <div class="bed-doctor-loader">
    <div class="animation">
      ğŸ¥ â¡ï¸ ğŸ¥ â¡ï¸ ğŸ¥ â¡ï¸ ğŸ‘¨â€âš•ï¸
    </div>
    <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
    <p>××¢×‘×“ ××™×“×¢ ×¨×¤×•××™...</p>
  </div>  <p>××•×¡×£ × ×ª×•× ×™× ×œ×“×•×— ××™×ª×‘....</p>
</div>

<!-- Entire Page (Hidden Until Data is Loaded) -->
<div *ngIf="!isLoading" class="body">
  <!-- Title Section -->
  <div class="nine">
    <h1>×“×•×— ××™×ª×‘</h1>
  </div>

<!-- Filters Section -->
<div class="filter-card">
  <div dir="rtl" class="card mat-elevation-z8">
    <div class="card-body">
      <div class="filter-container">
        <!-- Department Multi-Select -->
        <mat-form-field appearance="outline">
          <mat-label>Search</mat-label>
          <input matInput (keyup)="applyGlobalFilter($event)" placeholder="Search across all columns">
        </mat-form-field>
        <mat-form-field class="filter-field">
          <mat-label>×‘×—×¨ ××—×œ×§×•×ª</mat-label>
          <mat-select [(ngModel)]="selectedDepartments" multiple (selectionChange)="applyFilters()">
            <mat-option *ngFor="let department of departmentList" [value]="department">
              {{ department }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Start Date Filter -->
        <mat-form-field class="filter-field">
          <mat-label>×ª××¨×™×š ×”×ª×—×œ×”</mat-label>
          <input matInput [matDatepicker]="startDatePicker" [(ngModel)]="startDate" (ngModelChange)="applyFilters()" />
          <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>

        <!-- End Date Filter -->
        <mat-form-field class="filter-field">
          <mat-label>×ª××¨×™×š ×¡×™×•×</mat-label>
          <input matInput [matDatepicker]="endDatePicker" [(ngModel)]="endDate" (ngModelChange)="applyFilters()" />
          <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>

        <!-- Year Filter -->
        <mat-form-field class="filter-field">
          <mat-label>×‘×—×¨ ×©× ×”</mat-label>
          <mat-select [(ngModel)]="selectedYear" (selectionChange)="applyFilters()">
            <mat-option *ngFor="let year of yearList" [value]="year">
              {{ year }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Quarter Filter -->
        <mat-form-field class="filter-field">
          <mat-label>×‘×—×¨ ×¨×‘×¢×•×Ÿ</mat-label>
          <mat-select [(ngModel)]="selectedQuarter" (selectionChange)="applyFilters()">
            <mat-option *ngFor="let quarter of ['×¨×‘×¢×•×Ÿ 1', '×¨×‘×¢×•×Ÿ 2', '×¨×‘×¢×•×Ÿ 3', '×¨×‘×¢×•×Ÿ 4']" [value]="quarter">
              {{ quarter }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Filter Buttons -->
        <div class="filter-buttons" style="margin-top: 10px; text-align: right;">
          <button mat-raised-button color="warn" (click)="resetFilters()">××™×¤×•×¡</button>
        </div>
      
      </div>
    </div>
  </div>
</div>


<!-- Unified Gauge Section -->
<div class="gauge-section">
  <mat-card class="gauge-card">
    <div class="gauge-title">×¤×™×œ×•×— ××—×œ×§×ª×™ - ××“×“×™ × ×™×ª×•×—</div>

    <!-- Row of Gauges -->
    <div class="gauge-row">

      <!-- Total Mobility Score Gauge -->
      <!-- Total Mobility Score Gauge -->
<div class="gauge-item">
  <div class="gauge-title">×¤×™×œ×•×— ××—×œ×§×ª×™ - ×¦×™×•×Ÿ ××¡×›×</div>
  <ngx-gauge
    [value]="gaugeValue"
    [min]="0"
    [max]="100"
    [label]="''"
    [append]="'%'"
    [foregroundColor]="getGaugeColor()"> 
  </ngx-gauge>
  <div class="gauge-info">
    <strong>
      ×ª×§×™×Ÿ - {{ validMobilityCasesAboveThreshold }} / ×œ× ×ª×§×™×Ÿ - {{ invalidMobilityCasesBelowThreshold }} / ×¡×”"×› - {{ totalMobilityCases }}
    </strong>
  </div>
</div>

<!-- Recommendation for Walking Gauge -->
<div class="gauge-item">
  <div class="gauge-title">××¨×©× ×”×œ×™×›×”</div>
  <ngx-gauge
    [value]="recommendationForWalkingGauge"
    [min]="0"
    [max]="100"
    [label]="''"
    [append]="'%'"
    [foregroundColor]="recommendationForWalkingColor()"> 
  </ngx-gauge>
  <div class="gauge-info">
    <strong>×ª×§×™×Ÿ - {{ validWalkingCases }} / ×œ× ×ª×§×™×Ÿ - {{ invalidWalkingCases }} / ×¡×”"×› - {{ totalWalkingCases }}</strong>
  </div>
</div>

<!-- Consultation Status Gauge -->
<div class="gauge-item">
  <!-- <mat-icon matTooltip="×¨×œ×•×•× ×˜×™ ×¨×§ ×œ×“×¨×’×ª × ×™×“×•×ª 2/3" class="info-icon">info</mat-icon> -->
  <div class="gauge-title">
    ×”×–×× ×ª ×™×™×¢×•×¥ ×œ×¤×™×–×™×•×ª×¨×¤×™×” 
  </div>
  <ngx-gauge
    [value]="consultationPercentageGauge"
    [min]="0"
    [max]="100"
    [label]="''"
    [append]="'%'"
    [foregroundColor]="consultationGaugeColor()"> 
  </ngx-gauge>
  <div class="gauge-info">
    <strong>×ª×§×™×Ÿ  - {{ validConsultationCases }} /   ×œ× ×ª×§×™×Ÿ- {{ invalidConsultationCases }} / ×¡×”"×› - {{ totalConsultationCases }}</strong>
  </div>
</div>

<!-- Functional State (××¦×‘ ×ª×¤×§×•×“×™) -->
<div class="gauge-item">
  <div class="gauge-title">××¦×‘ ×ª×¤×§×•×“×™</div>
  <ngx-gauge
    [value]="functionalStateGauge"
    [min]="0"
    [max]="100"
    [label]="''"
    [append]="'%'"
    [foregroundColor]="functionalStateGaugeColor()"> 
  </ngx-gauge>
  <div class="gauge-info">
    <strong> ×ª×§×™×Ÿ {{ validFunctionalCases }} / ×œ× ×ª×§×™×Ÿ {{ invalidFunctionalCases }} / ×¡×”"×› - {{ totalFunctionalCases }} </strong>
  </div>
</div>

<!-- Mobility State (××¦×‘ × ×™×™×“×•×ª) -->
<div class="gauge-item">
  <div class="gauge-title">×”×¢×¨×›×ª × ×™×™×“×•×ª ×‘×§×‘×œ×” </div>
  <ngx-gauge
    [value]="mobilityStateGauge"
    [min]="0"
    [max]="100"
    [label]="''"
    [append]="'%'"
    [foregroundColor]="mobilityStateGaugeColor()"> 
  </ngx-gauge>
  <div class="gauge-info">
    <strong> ×ª×§×™×Ÿ {{ validMobilityStateCases }} / ×œ× ×ª×§×™×Ÿ {{ invalidMobilityStateCases }} / ×¡×”"×› - {{ totalMobilityStateCases }} </strong>
  </div>
</div>


    </div> <!-- End of gauge-row -->

    <!-- Button Section -->
    <div class="button-section">
      <button mat-raised-button color="primary" (click)="openDepartmentPercentagesDialog()">
        ×¤×™×œ×•×— ××—×œ×§×ª×™ - ×¦×™×•×Ÿ ××¡×›×
      </button>
    </div>

  </mat-card>
</div>





  <!-- Tabs Section -->
  <!-- <mat-tab-group dir="rtl"> -->
    <!-- Mobility Tab -->
   
      <!-- Button to Toggle Between Table and Pie Chart -->
      <img 
          *ngIf="!showGraph" 
          (click)="toggleView()" 
          matTooltip="Move To Graph" 
          src="../../../../assets/graphIcon.png" 
          width="50px" 
          style="margin-left: 10px;" 
        />
        <img 
          *ngIf="showGraph" 
          (click)="toggleView()" 
          matTooltip="Move To Table" 
          src="../../../../assets/TableIcon.png" 
          width="50px" 
          style="margin-left: 10px;" 
        />
        <img src="../../assets/excel.png" alt="Download" (click)="exportToExcel()" class="download-icon" width="50px" />

      <!-- Table Section -->
      <div *ngIf="!showGraph" class="table-section" dir="rtl">
        <table mat-table [dataSource]="dataSource" matSort>
           <!-- Admission No Column -->
           <ng-container matColumnDef="AdmissionNo">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××¡×¤×¨ ××©×¤×•×–</th>
            <td mat-cell *matCellDef="let element"> {{ element.AdmissionNo }}</td>
          </ng-container>
      
          <!-- Unit Name Column -->
          <ng-container matColumnDef="UnitName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××—×œ×§×”</th>
            <td mat-cell *matCellDef="let element"> {{ element.UnitName }}</td>
          </ng-container>
      
          <!-- Age Column -->
          <ng-container matColumnDef="AgeYears">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×’×™×œ (×©× ×™×)</th>
            <td mat-cell *matCellDef="let element"> {{ element.AgeYears }}</td>
          </ng-container>
      
          <!-- Admission Date Column -->
          <ng-container matColumnDef="AdmissionDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×ª××¨×™×š ×›× ×™×¡×”</th>
            <td mat-cell *matCellDef="let element">
              {{ element.AdmissionDate | date:'dd/MM/yyyy' }}
            </td>
          </ng-container>
      
          <!-- Release Date Column -->
          <ng-container matColumnDef="ReleaseDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×ª××¨×™×š ×©×—×¨×•×¨</th>
            <td mat-cell *matCellDef="let element">
              {{ element.ReleaseDate | date:'dd/MM/yyyy HH:mm' }}
            </td>
          </ng-container>
      
          <!-- Mobility Grade Column -->
          <ng-container matColumnDef="MobilityGrade">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×“×¨×’×ª × ×™×™×“×•×ª</th>
            <td mat-cell *matCellDef="let element"> {{ element.MobilityGrade }}</td>
          </ng-container>
      <!-- Cognitive Function Before Hospitalization Column -->
<ng-container matColumnDef="CognitiveFunctionBeforeHospitalization">
  <th mat-header-cell *matHeaderCellDef mat-sort-header>×ª×¤×§×•×“ ×§×•×’× ×™×˜×™×‘×™ ×œ×¤× ×™ ××©×¤×•×–</th>
  <td mat-cell *matCellDef="let element">
    {{ element.CognitiveFunctionBeforeHospitalization }}
  </td>
</ng-container>

<!-- Mobility Before Hospitalization Column -->
<ng-container matColumnDef="MobilityBeforeHospitalization">
  <th mat-header-cell *matHeaderCellDef mat-sort-header>× ×™×™×“×•×ª ×œ×¤× ×™ ××©×¤×•×–</th>
  <td mat-cell *matCellDef="let element">
    {{ element.MobilityBeforeHospitalization }}
  </td>
</ng-container>

<!-- Basic Function Before Hospitalization Column -->
<ng-container matColumnDef="BasicFunctionBeforeHospitalization">
  <th mat-header-cell *matHeaderCellDef mat-sort-header>×ª×¤×§×•×“ ×‘×¡×™×¡×™ ×œ×¤× ×™ ××©×¤×•×–</th>
  <td mat-cell *matCellDef="let element">
    {{ element.BasicFunctionBeforeHospitalization }}
  </td>
</ng-container>
          <!-- Consultation Status Column -->
          <ng-container matColumnDef="ConsultationStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×¡×˜×˜×•×¡ ×™×™×¢×•×¥</th>
            <td mat-cell *matCellDef="let element"> {{ element.ConsultationStatus }}</td>
          </ng-container>
      
          <!-- Recommendation For Walking Column -->
          <ng-container matColumnDef="RecommendationForWalking">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×”××œ×¦×” ×œ×”×œ×™×›×”</th>
            <td mat-cell *matCellDef="let element"> {{ element.RecommendationForWalking }}</td>
          </ng-container>
      
          <!-- Required Assistive Device Column -->
          <ng-container matColumnDef="RequiredAssistiveDevice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××‘×™×–×¨ ×¢×–×¨ × ×“×¨×©</th>
            <td mat-cell *matCellDef="let element"> {{ element.RequiredAssistiveDevice }}</td>
          </ng-container>
      
          <!-- Recommended Walking Distance Column -->
          <ng-container matColumnDef="RecommendedWalkingDistance">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××¨×—×§ ×”×œ×™×›×” ××•××œ×¥</th>
            <td mat-cell *matCellDef="let element"> {{ element.RecommendedWalkingDistance }}</td>
          </ng-container>
      
          <!-- Morning Shift Count Column
          <ng-container matColumnDef="MorningShiftCount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××¡×¤×¨ ××©××¨×•×ª ×‘×•×§×¨</th>
            <td mat-cell *matCellDef="let element"> {{ element.MorningShiftCount }}</td>
          </ng-container>
      
         
          <ng-container matColumnDef="NightShiftCount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>××¡×¤×¨ ××©××¨×•×ª ×œ×™×œ×”</th>
            <td mat-cell *matCellDef="let element"> {{ element.NightShiftCount }}</td>
          </ng-container>
       -->
          <!-- Dates With Both Shifts Column -->
          <ng-container matColumnDef="DatesWithBothShifts">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×”×œ×™×›×” ×‘×¤×•×¢×œ (×‘×™××™×)</th>
            <td mat-cell *matCellDef="let element"> {{ element.DatesWithBothShifts }}</td>
          </ng-container>
      
          <!-- Total Days In Hospital Column -->
          <ng-container matColumnDef="TotalDaysInHospital">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×¡×š ×”×™××™× ×‘××©×¤×•×–</th>
            <td mat-cell *matCellDef="let element"> {{ element.TotalDaysInHospital }}</td>
          </ng-container>
      
          <!-- Total Percentage Column -->
          <ng-container matColumnDef="TotalPercentage">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> ××—×•×– ×›×•×œ×œ ( ×™×¢×“ ××¢×œ 70%)</th>
            <td mat-cell *matCellDef="let element"> {{ element.TotalPercentage }}%</td>
          </ng-container>
      
          <!-- Is Record Matching Release Date Column -->
          <ng-container matColumnDef="IsRecordMatchingReleaseDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×ª×•×× ×ª××¨×™×š ×©×—×¨×•×¨</th>
            <td mat-cell *matCellDef="let element">
              {{ element.IsRecordMatchingReleaseDate ? '×›×Ÿ' : '×œ×' }}
            </td>
          </ng-container>
      
          <!-- Has Record Per Date Column -->
          <ng-container matColumnDef="HasRecordPerDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>×¨×©×•××” ×œ×¤×™ ×ª××¨×™×š</th>
            <td mat-cell *matCellDef="let element">
              {{ element.HasRecordPerDate ? '×›×Ÿ' : '×œ×' }}
            </td>
          </ng-container>
          <!-- Header and Row Definitions -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="openDetailsDialog(row.AdmissionNo)"></tr>
        </table>
  
        <!-- Paginator -->
        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
      </div>
  
      <!-- Pie Chart Section -->
      <div *ngIf="showGraph" class="chart-container">
        <h3>Distribution of Mobility Grades</h3>
        <canvas #chartCanvas width="400" height="400"></canvas>
       
      </div>

  
   <!-- Delirium Report Tab -->
  <!-- <mat-tab label="×“×œ×¨×™×•×">
    <div class="placeholder-content">
      <h3>Mitav Delirium Report</h3>
      <mat-table [dataSource]="deliriumDataSource" matSort class="mat-elevation-z8">
        <ng-container *ngFor="let column of deliriumDisplayedColumns" [matColumnDef]="column">
          <mat-header-cell *matHeaderCellDef> {{ column }} </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{ element[column] }} </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="deliriumDisplayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: deliriumDisplayedColumns;"></mat-row>
      </mat-table>

      <mat-paginator #paginatorDelirium="matPaginator"  [pageSizeOptions]="[5, 25, 50]" showFirstLastButtons></mat-paginator>
    </div>
  </mat-tab> -->

  <!-- </mat-tab-group> -->
  
</div>
